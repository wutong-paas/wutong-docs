"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[219],{3905:function(e,r,n){n.d(r,{Zo:function(){return u},kt:function(){return m}});var o=n(7294);function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function a(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){t(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function c(e,r){if(null==e)return{};var n,o,t=function(e,r){if(null==e)return{};var n,o,t={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],r.indexOf(n)>=0||(t[n]=e[n]);return t}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}var i=o.createContext({}),l=function(e){var r=o.useContext(i),n=r;return e&&(n="function"==typeof e?e(r):s(s({},r),e)),n},u=function(e){var r=l(e.components);return o.createElement(i.Provider,{value:r},e.children)},g={inlineCode:"code",wrapper:function(e){var r=e.children;return o.createElement(o.Fragment,{},r)}},d=o.forwardRef((function(e,r){var n=e.components,t=e.mdxType,a=e.originalType,i=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),d=l(n),m=t,p=d["".concat(i,".").concat(m)]||d[m]||g[m]||a;return n?o.createElement(p,s(s({ref:r},u),{},{components:n})):o.createElement(p,s({ref:r},u))}));function m(e,r){var n=arguments,t=r&&r.mdxType;if("string"==typeof e||t){var a=n.length,s=new Array(a);s[0]=d;var c={};for(var i in r)hasOwnProperty.call(r,i)&&(c[i]=r[i]);c.originalType=e,c.mdxType="string"==typeof e?e:t,s[1]=c;for(var l=2;l<a;l++)s[l]=n[l];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6850:function(e,r,n){n.r(r),n.d(r,{assets:function(){return u},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return c},metadata:function(){return l},toc:function(){return g}});var o=n(7462),t=n(3366),a=(n(7294),n(3905)),s=["components"],c={slug:"zhoupeng/20220311/kunpeng-install",title:"\u9cb2\u9e4f\u9002\u914d\u5b89\u88c5",authors:["zhoupeng"],tags:["kunpeng","install"]},i=void 0,l={permalink:"/wutong-docs/blog/zhoupeng/20220311/kunpeng-install",editUrl:"https://github.com/wutong-paas/wutong-docs/tree/master/blog/2022-03-11-kunpeng-install.md",source:"@site/blog/2022-03-11-kunpeng-install.md",title:"\u9cb2\u9e4f\u9002\u914d\u5b89\u88c5",description:"\u5b89\u88c5\u73af\u5883",date:"2022-03-11T00:00:00.000Z",formattedDate:"March 11, 2022",tags:[{label:"kunpeng",permalink:"/wutong-docs/blog/tags/kunpeng"},{label:"install",permalink:"/wutong-docs/blog/tags/install"}],readingTime:3.735,truncated:!1,authors:[{name:"\u5468\u9e4f",title:"\u68a7\u6850PaaS\u5e73\u53f0\u5f00\u53d1\u8005",url:"https://github.com/zhoupeng24088",imageURL:"https://github.com/zhoupeng24088.png",key:"zhoupeng"}],frontMatter:{slug:"zhoupeng/20220311/kunpeng-install",title:"\u9cb2\u9e4f\u9002\u914d\u5b89\u88c5",authors:["zhoupeng"],tags:["kunpeng","install"]},nextItem:{title:"\u6280\u672f\u535a\u5ba2\u7f16\u5236\u624b\u518c",permalink:"/wutong-docs/blog/fcheng/20220309/blog-tutorial"}},u={authorsImageUrls:[void 0]},g=[{value:"\u5b89\u88c5\u73af\u5883",id:"\u5b89\u88c5\u73af\u5883",level:2},{value:"\u5b89\u88c5docker \u8bbe\u7f6e\u53c2\u6570",id:"\u5b89\u88c5docker-\u8bbe\u7f6e\u53c2\u6570",level:2},{value:"kubeadm \u5b89\u88c5K8s\u96c6\u7fa4",id:"kubeadm-\u5b89\u88c5k8s\u96c6\u7fa4",level:2},{value:"\u51c6\u5907\u955c\u50cf",id:"\u51c6\u5907\u955c\u50cf",level:4},{value:"\u914d\u7f6e arm \u7684 yum \u6e90",id:"\u914d\u7f6e-arm-\u7684-yum-\u6e90",level:4},{value:"\u6240\u6709\u8282\u70b9\u5b89\u88c5K8S\u7ec4\u4ef6",id:"\u6240\u6709\u8282\u70b9\u5b89\u88c5k8s\u7ec4\u4ef6",level:4},{value:"\u521d\u59cb\u5316\u96c6\u7fa4",id:"\u521d\u59cb\u5316\u96c6\u7fa4",level:4},{value:"\u5b89\u88c5 sfs \u5b58\u50a8\u63d2\u4ef6",id:"\u5b89\u88c5-sfs-\u5b58\u50a8\u63d2\u4ef6",level:4},{value:"\u6302\u8f7dsfs\u6587\u4ef6\u7cfb\u7edf",id:"\u6302\u8f7dsfs\u6587\u4ef6\u7cfb\u7edf",level:4},{value:"\u68a7\u6850PAAS\u5b89\u88c5",id:"\u68a7\u6850paas\u5b89\u88c5",level:2},{value:"\u5b89\u88c5console",id:"\u5b89\u88c5console",level:4},{value:"\u63a5\u5165K8S\u96c6\u7fa4\uff08\u5b89\u88c5rbd\u7ec4\u4ef6\uff09",id:"\u63a5\u5165k8s\u96c6\u7fa4\u5b89\u88c5rbd\u7ec4\u4ef6",level:4}],d={toc:g};function m(e){var r=e.components,n=(0,t.Z)(e,s);return(0,a.kt)("wrapper",(0,o.Z)({},d,n,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"\u5b89\u88c5\u73af\u5883"},"\u5b89\u88c5\u73af\u5883"),(0,a.kt)("p",null,"\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\uff1aopenEuler 20.03"),(0,a.kt)("p",null,"kuberneteas \u7248\u672c\uff1aV1.22.7"),(0,a.kt)("p",null,"Docker\u7248\u672c\uff1a20.10.9"),(0,a.kt)("p",null,"\u68a7\u6850\u5e73\u53f0\u7248\u672c\uff1aV5.5.0"),(0,a.kt)("h2",{id:"\u5b89\u88c5docker-\u8bbe\u7f6e\u53c2\u6570"},"\u5b89\u88c5docker \u8bbe\u7f6e\u53c2\u6570"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"wget https://download.docker.com/linux/static/stable/aarch64/docker-20.10.9.tgz -o /opt/tools\ntar zxf docker-20.10.9.tgz && cp docker/* /user/bin\n\n# \u914d\u7f6edocker\u5b88\u62a4\u8fdb\u7a0b\ncat <<EOF > /usr/lib/systemd/system/docker.service\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service\nWants=network-online.target\n  \n[Service]\nType=notify\n# the default is not to use systemd for cgroups because the delegate issues still\n# exists and systemd currently does not support the cgroup feature set required\n# for containers run by docker\nExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock\nExecReload=/bin/kill -s HUP $MAINPID\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\n# Uncomment TasksMax if your systemd version supports it.\n# Only systemd 226 and above support this version.\n#TasksMax=infinity\nTimeoutStartSec=0\n# set delegate yes so that systemd does not reset the cgroups of docker containers\nDelegate=yes\n# kill only the docker process, not all processes in the cgroup\nKillMode=process\n# restart the docker process if it exits prematurely\nRestart=on-failure\nStartLimitBurst=3\nStartLimitInterval=60s\n  \n[Install]\nWantedBy=multi-user.target\nEOF\n\n# \u8bbe\u7f6edocker\u5f00\u673a\u542f\u52a8\nsystemctl enable docker && systemctl restart docker\n")),(0,a.kt)("h2",{id:"kubeadm-\u5b89\u88c5k8s\u96c6\u7fa4"},"kubeadm \u5b89\u88c5K8s\u96c6\u7fa4"),(0,a.kt)("h4",{id:"\u51c6\u5907\u955c\u50cf"},"\u51c6\u5907\u955c\u50cf"),(0,a.kt)("p",null,"\u5927\u90e8\u5206\u955c\u50cf\u90fd\u6709arm64\u7248\u672c\uff0c\u53ea\u6709etcd\u9700\u8981\u81ea\u884c\u6839\u636earm64\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u6784\u5efa\u955c\u50cf"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"wget https://github.com/etcd-io/etcd/releases/download/v3.5.0/etcd-v3.5.0-linux-arm64.tar.gz\n\ntar zxf etcd-v3.5.0-linux-arm64.tar.gz\ncd etcd-v3.5.0-linux-arm64\ndocker build -t registry.aliyuncs.com/google_containers/etcd:3.5.0-0 .\n\n\n")),(0,a.kt)("h4",{id:"\u914d\u7f6e-arm-\u7684-yum-\u6e90"},"\u914d\u7f6e arm \u7684 yum \u6e90"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cat <<EOF > /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-aarch64\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\nyum clean all && yum makecache\n\nyum list kubectl --showduplicates | sort -r\n\n")),(0,a.kt)("h4",{id:"\u6240\u6709\u8282\u70b9\u5b89\u88c5k8s\u7ec4\u4ef6"},"\u6240\u6709\u8282\u70b9\u5b89\u88c5K8S\u7ec4\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y kubelet-1.22.7 kubeadm-1.22.7 kubectl-1.22.7 kubernetes-cni-0.8.7-0.aarch64\n\n# \u8bbe\u7f6ekubelet\u5f00\u673a\u542f\u52a8\nsystemctl daemon-reload && systemctl enable kubelet && systemctl restart kubelet\n")),(0,a.kt)("h4",{id:"\u521d\u59cb\u5316\u96c6\u7fa4"},"\u521d\u59cb\u5316\u96c6\u7fa4"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'kubeadm init \\\n--kubernetes-version=v1.22.7 \\\n--apiserver-cert-extra-sans=10.96.0.1,192.168.0.169,192.168.0.21,192.168.0.22,192.168.0.23 \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--pod-network-cidr=10.244.0.0/16 \\\n--ignore-preflight-errors=Swap \\\n--control-plane-endpoint "192.168.0.169:6443" \\\n--upload-certs \\\n--v=3\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\uff1a\u66ff\u6362apiserver-cert-extra-sans \u548c control-plane-endpoint \u5730\u5740\u4e3a\u5b9e\u9645\u5730\u5740")),(0,a.kt)("h4",{id:"\u5b89\u88c5-sfs-\u5b58\u50a8\u63d2\u4ef6"},"\u5b89\u88c5 sfs \u5b58\u50a8\u63d2\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/\nmkdir sfs-charts\nhelm show values nfs-subdir-external-provisioner/nfs-subdir-external-provisioner > ./sfs-charts/values.yaml\n\n# \u4fee\u6539values\u6587\u4ef6\u4ee5\u4e0b\u914d\u7f6e\nrepository: devhub.devcloud.talkweb.com.cn/sig-storage/nfs-subdir-external-provisioner-arm64:v4.0.2\nnfs.server\uff1a172.16.1.46  # \u5b9e\u9645\u7684sfs\u5730\u5740\nnfs.path\uff1a/\nstorageClass.name\uff1asfs\n\n# \u5b89\u88c5\u63d2\u4ef6\nhelm install nfs-subdir-external-provisioner -f ./sfs-charts/values.yaml nfs-subdir-external-provisioner/nfs-subdir-external-provisioner\n")),(0,a.kt)("h4",{id:"\u6302\u8f7dsfs\u6587\u4ef6\u7cfb\u7edf"},"\u6302\u8f7dsfs\u6587\u4ef6\u7cfb\u7edf"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"# \u6302\u8f7d\u76ee\u5f55\nmount -t nfs -o vers=3,nolock 192.168.0.99:/  /mnt/sfs_turbo\n\n#fstab \u914d\u7f6e\n192.168.0.99:/ /mnt/sfs_turbo nfs vers=3,timeo=600,nolock 0 0\n")),(0,a.kt)("h2",{id:"\u68a7\u6850paas\u5b89\u88c5"},"\u68a7\u6850PAAS\u5b89\u88c5"),(0,a.kt)("h4",{id:"\u5b89\u88c5console"},"\u5b89\u88c5console"),(0,a.kt)("p",null,"\u76ee\u524d\u6ca1\u6709\u5bf9\u5e94arm\u5e73\u53f0\u7684 allinone \u955c\u50cf\uff0c\u56e0\u6b64console\u5b89\u88c5\u5728X86\u5e73\u53f0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"helm repo add wutong-paas https://openchart.goodrain.com/goodrain/rainbond\n# \u4e0b\u8f7dconsole\nhelm pull rainbond/rainbond-console\n# \u914d\u7f6evalue.yaml \u6309\u5b9e\u9645\u60c5\u51b5\u8c03\u6574\u4ee5\u4e0b\u914d\u7f6e(\u9ed8\u8ba4allinone\u6a21\u5f0f)\npvc:\nredis:\nmysql:\n")),(0,a.kt)("h4",{id:"\u63a5\u5165k8s\u96c6\u7fa4\u5b89\u88c5rbd\u7ec4\u4ef6"},"\u63a5\u5165K8S\u96c6\u7fa4\uff08\u5b89\u88c5rbd\u7ec4\u4ef6\uff09"),(0,a.kt)("p",null,"\u63d0\u524d\u4e0b\u8f7d\u5bf9\u5e94\u955c\u50cf\uff0c\u76ee\u524d\u955c\u50cf\u5927\u90e8\u5206\u5728\u5b98\u7f51\u4ed3\u5e93\u53ef\u627e\u5230\uff0c\u53ea\u6709nfs-provisioner\u5b58\u50a8\u63d2\u4ef6\u955c\u50cf\u9700\u8981\u81ea\u7f16\u8bd1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"docker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rainbond-operator:v2.2.0-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rainbond-operator:v2.2.0-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/rainbond-operator:v2.2.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-chaos:v5.5.0-release-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-chaos:v5.5.0-release-arm64  registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-chaos:v5.5.0-release\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-node:v5.5.0-release-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-node:v5.5.0-release-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-node:v5.5.0-release\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-gateway:v5.5.0-release-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-gateway:v5.5.0-release-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-gateway:v5.5.0-release\ndocker pull gcr.io/google-containers/etcd-arm64:3.3.17\ndocker tag gcr.io/google-containers/etcd-arm64:3.3.17 registry.cn-hangzhou.aliyuncs.com/goodrain/etcd:v3.3.18\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/metrics-scraper:v1.0.4\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/metrics-scraper:v1.0.4-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/metrics-scraper:v1.0.4\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-api:v5.5.0-release-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-api:v5.5.0-release-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-api:v5.5.0-release\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-eventlog:v5.5.0-release-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-eventlog:v5.5.0-release-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-eventlog:v5.5.0-release\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/metrics-server:v0.3.6-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/metrics-server:v0.3.6-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/metrics-server:v0.3.6\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-monitor:v5.5.0-release-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-monitor:v5.5.0-release-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-monitor:v5.5.0-release\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-mq:v5.5.0-release-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-mq:v5.5.0-release-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-mq:v5.5.0-release\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/kubernetes-dashboard:v2.0.1-3-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/kubernetes-dashboard:v2.0.1-3-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/kubernetes-dashboard:v2.0.1-3\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-resource-proxy:v5.5.0-release-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-resource-proxy:v5.5.0-release-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-resource-proxy:v5.5.0-release\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-webcli:v5.5.0-release-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-webcli:v5.5.0-release-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-webcli:v5.5.0-release\ndocker pull registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-worker:v5.5.0-release-arm64\ndocker tag registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-worker:v5.5.0-release-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-worker:v5.5.0-release\ndocker pull swr.cn-southwest-2.myhuaweicloud.com/wutong/nfs-provisioner:v1.0.0-stable\ndocker tag swr.cn-southwest-2.myhuaweicloud.com/wutong/nfs-provisioner:v1.0.0-stable registry.cn-hangzhou.aliyuncs.com/goodrain/nfs-provisioner\ndocker pull registry:2.6.2\ndocker tag registry:2.6.2 registry.cn-hangzhou.aliyuncs.com/goodrain/registry:2.6.2\ndocker pull mysql:8.0-oracle\ndocker tag mysql:8.0-oracle registry.cn-hangzhou.aliyuncs.com/goodrain/rbd-db:8.0.19\ndocker pull prom/mysqld-exporter:latest\ndocker tag prom/mysqld-exporter:latest registry.cn-hangzhou.aliyuncs.com/goodrain/mysqld-exporter\ndocker pull rancher/metrics-server:v0.3.6-arm64\ndocker tag rancher/metrics-server:v0.3.6-arm64 registry.cn-hangzhou.aliyuncs.com/goodrain/metrics-server:v0.3.6\ndocker pull kubernetesui/metrics-scraper:v1.0.4\ndocker tag kubernetesui/metrics-scraper:v1.0.4 registry.cn-hangzhou.aliyuncs.com/goodrain/metrics-scraper:v1.0.4\n")),(0,a.kt)("p",null,"\u6700\u540econsole \u754c\u9762\u5bfc\u5165\u96c6\u7fa4\n",(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/23066464/158973160-a543f09e-a6b3-4dfc-b79f-5f82150ce8ed.png",alt:"image"})))}m.isMDXComponent=!0}}]);